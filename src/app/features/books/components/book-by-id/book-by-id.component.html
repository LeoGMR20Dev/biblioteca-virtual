<div class="row text-center my-4">
  <h1>Editar datos del libro</h1>
</div>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-10">
      <div *ngIf="isLoading" class="text-center my-5">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
      </div>

      <div class="card" *ngIf="!isLoading">
        <div class="card-body">
          <form [formGroup]="bookForm" (ngSubmit)="onSubmit()">
            <div class="row">
              <div class="col">
                <div class="mb-3">
                  <label for="isbn" class="form-label">Código ISBN</label>
                  <input
                    type="text"
                    id="isbn"
                    class="form-control"
                    formControlName="isbn"
                    placeholder="Ingrese el código ISBN del libro"
                    [class.is-invalid]="isFieldInvalid('isbn')"
                  />
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('isbn')">
                    {{ getErrorMessage("isbn", "ISBN") }}
                  </div>
                </div>
                <div class="mb-3">
                  <label for="title" class="form-label">Título</label>
                  <input
                    type="text"
                    id="title"
                    class="form-control"
                    formControlName="title"
                    placeholder="Ingrese el título del libro"
                    [class.is-invalid]="isFieldInvalid('title')"
                  />
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('title')">
                    {{ getErrorMessage("title", "Título") }}
                  </div>
                </div>
                <div class="mb-3">
                  <label for="category" class="form-label">Categoría</label>
                  <select
                    formControlName="category"
                    id="category"
                    class="form-select"
                    [class.is-invalid]="isFieldInvalid('category')"
                  >
                    <option
                      *ngFor="let category of bookCategories"
                      [value]="category"
                    >
                      {{ category }}
                    </option>
                  </select>
                  <div
                    class="invalid-feedback"
                    *ngIf="isFieldInvalid('category')"
                  >
                    {{ getErrorMessage("category", "Categoría") }}
                  </div>
                </div>
                <div class="mb-3">
                  <label for="authorFullname" class="form-label">Autor</label>
                  <input
                    type="text"
                    id="authorFullname"
                    class="form-control"
                    formControlName="authorFullname"
                    placeholder="Ingrese el nombre completo del autor"
                    [class.is-invalid]="isFieldInvalid('authorFullname')"
                  />
                  <div
                    class="invalid-feedback"
                    *ngIf="isFieldInvalid('authorFullname')"
                  >
                    {{ getErrorMessage("authorFullname", "Autor") }}
                  </div>
                </div>
                <div class="mb-3">
                  <label for="yearPublication" class="form-label"
                    >Año de publicación</label
                  >
                  <input
                    type="number"
                    id="yearPublication"
                    class="form-control"
                    formControlName="yearPublication"
                    placeholder="Ingrese el año en que se publicó el libro"
                    [class.is-invalid]="isFieldInvalid('yearPublication')"
                  />
                  <div
                    class="invalid-feedback"
                    *ngIf="isFieldInvalid('yearPublication')"
                  >
                    {{
                      getErrorMessage("yearPublication", "Año de publicación")
                    }}
                  </div>
                </div>
                <div class="mb-3">
                  <label for="price" class="form-label">Precio ($)</label>
                  <input
                    type="number"
                    id="price"
                    class="form-control"
                    formControlName="price"
                    placeholder="Ingrese el precio unitario del libro"
                    [class.is-invalid]="isFieldInvalid('price')"
                  />
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('price')">
                    {{ getErrorMessage("price", "Precio") }}
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="mb-3">
                  <label for="physicalStock" class="form-label"
                    >Existencias físicas</label
                  >
                  <input
                    type="number"
                    id="physicalStock"
                    class="form-control"
                    formControlName="physicalStock"
                    placeholder="Ingrese las existencias físicas del libro"
                    [class.is-invalid]="isFieldInvalid('physicalStock')"
                  />
                  <div
                    class="invalid-feedback"
                    *ngIf="isFieldInvalid('physicalStock')"
                  >
                    {{
                      getErrorMessage("physicalStock", "Existencias físicas")
                    }}
                  </div>
                </div>
                <div class="mb-3">
                  <label for="imageCover" class="form-label"
                    >Imagen de portada</label
                  >
                  <input
                    #imageCoverInput
                    type="file"
                    id="imageCover"
                    class="form-control"
                    accept="image/png, image/jpeg"
                    (change)="onFileChange($event)"
                    [class.is-invalid]="isFieldInvalid('imageCover')"
                  />
                  <div
                    class="invalid-feedback"
                    *ngIf="isFieldInvalid('imageCover')"
                  >
                    {{ getErrorMessage("imageCover", "Imagen de portada") }}
                  </div>
                </div>
                <div *ngIf="previewImage()">
                  <p>Imagen seleccionada:</p>
                  <img
                    [src]="previewImage()"
                    class="img-thumbnail w-100 image-preview"
                  />
                </div>
              </div>
            </div>

            <div class="d-flex gap-2 justify-content-end">
              <button
                type="button"
                class="btn btn-secondary"
                (click)="onCancel()"
                [disabled]="isSubmitting"
              >
                Volver
              </button>
              <button
                type="button"
                class="btn btn-danger"
                (click)="onClear()"
                [disabled]="isSubmitting"
              >
                Reiniciar
              </button>
              <button type="submit" class="btn btn-primary">
                {{ isSubmitting ? "Guardando..." : "Guardar" }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
